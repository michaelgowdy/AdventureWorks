@page "/sales/add"
@page "/sales/edit/{salesOrderId:int}"

@using AdventureWorks.Models
@using AdventureWorks.Models.Models
@using AdventureWorks.Web.Api.Client

@inject NavigationManager NavigationManager

<h3>@Title Sale</h3>

<EditForm Model="sale" OnValidSubmit="SaveSale">
    <DataAnnotationsValidator />

    <div class=validation-message> @*??*@

    </div>

    <div class="mb-3">
        <label for="SalesOrderID" class="form-label">Sales Order ID</label>
        <div class="col-md-4">
            <InputNumber class="form-control" @bind-Value="sale.SalesOrderID" />
        </div>
        <ValidationMessage For="@(() => sale.SalesOrderID)" />
    </div>
    <div class="mb-3">
        <label for="OrderDate" class="form-label">Order Date</label>
        <div class="col-md-4">
            <InputDate class="form-control" @bind-Value="sale.OrderDate" />
        </div>
        <ValidationMessage For="@(() => sale.OrderDate)" />
    </div>
    <div class="mb-3">
        <label for="BillToAddressID" class="form-label">Bill To Address ID</label>
        <div class="col-md-4">
            <InputNumber class="form-control" @bind-Value="sale.BillToAddressID" />
        </div>
        <ValidationMessage For="@(() => sale.BillToAddressID)" />
    </div>
    <div class="mb-3">
        <label for="ShipToAddressID" class="form-label">Ship To Address ID</label>
        <div class="col-md-4">
            <InputNumber class="form-control" @bind-Value="sale.ShipToAddressID" />
        </div>
        <ValidationMessage For="@(() => sale.ShipToAddressID)" />
    </div>
    <div class="mb-3">
        <label for="TotalDue" class="form-label">Sub Total</label>
        <div class="col-md-4">
            <InputNumber class="form-control" @bind-Value="sale.SubTotal" />
        </div>
        <ValidationMessage For="@(() => sale.SubTotal)" />
    </div>
    <div class="mb-3">
        <label for="TotalDue" class="form-label">Tax Amount</label>
        <div class="col-md-4">
            <InputNumber class="form-control" @bind-Value="sale.TaxAmt" />
        </div>
        <ValidationMessage For="@(() => sale.TaxAmt)" />
    </div>
    <div class="mb-3">
        <label for="TotalDue" class="form-label">Freight</label>
        <div class="col-md-4">
            <InputNumber class="form-control" @bind-Value="sale.Freight" />
        </div>
        <ValidationMessage For="@(() => sale.Freight)" />
    </div>
    <div class="form-group">
        <button type="submit" class="btn btn-primary" @onclick="(() => SaveSale())">Save</button>
        <button class="btn btn-light" @onclick="Cancel">Cancel</button>
    </div>
</EditForm>



@code {
    [Parameter]
    public int salesOrderId { get; set; }

    protected string Title = "Add";
    protected SalesOrderHeaderModel sale = new SalesOrderHeaderModel();
    protected override async Task OnParametersSetAsync()
    {   
        if (salesOrderId != 0)
        {
            Title = "Edit";

            var getrequest = SalesClient.GetOneSaleClient(salesOrderId);
            sale.SalesOrderID = getrequest.SalesOrderID;
            sale.OrderDate = getrequest.OrderDate;
            sale.BillToAddressID = getrequest.BillToAddressID;
            sale.ShipToAddressID = getrequest.ShipToAddressID;
            sale.SubTotal = getrequest.SubTotal;
            sale.TaxAmt = getrequest.TaxAmt;
            sale.Freight = getrequest.Freight;
        }
    }
    protected async Task SaveSale()
    {
        if (salesOrderId != 0) 
        {
            SalesClient.UpdateSaleClient(sale);
        }
        else
        {
            SalesClient.AddSaleClient(sale);
        }
        Cancel();
    }
    public void Cancel()
    {
        NavigationManager.NavigateTo("/sales");
    }
}
